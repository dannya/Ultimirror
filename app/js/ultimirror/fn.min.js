const path=require("path"),traverse=require("traverse"),electron=require("electron"),Promise=require("promise");var _autoChangeInterval,fn={network:{hasInternet:function(e){require("dns").lookup("google.com",function(r){e(r&&"ENOTFOUND"===r.code?!1:!0)})}},createWindow:function(){var e=new electron.BrowserWindow({width:ultimirror.config.windowedWidth,height:ultimirror.config.windowedHeight,minWidth:600,minHeight:600,alwaysOnTop:ultimirror.config.notOnTop===!1&&ultimirror.config.debug===!1,darkTheme:!0,fullscreen:ultimirror.config.windowed===!1,titleBarStyle:"hidden",webPreferences:{zoomFactor:ultimirror.config.zoom?ultimirror.config.zoom:1,plugins:!0,webSecurity:!1,webaudio:ultimirror.config.mute===!1,experimentalFeatures:!0,experimentalCanvasFeatures:!0},title:ultimirror.sys.name+" "+ultimirror.sys.version});e.loadURL("http://localhost:"+ultimirror.config.port+"/"+(ultimirror.config.config?"admin.html":"mirror.html")+"?context=electron"),e.setAutoHideMenuBar(!0),e.setMenuBarVisibility(!1),ultimirror.config.webInspector===!0&&e.webContents.openDevTools(),e.on("page-title-updated",function(e){e.preventDefault()}),e.on("closed",function(){e=null});var r=electron.powerSaveBlocker.start("prevent-display-sleep");return{win:e,powersave:r}},update:function(e,r){traverse(ultimirror).set(e,r),e.unshift("ultimirror"),ipc.emit("setData",{keyPath:e,data:r})},layout:{autoChangeDisplay:function(){return ultimirror.config.noAutoChange?!1:(_autoChangeInterval&&clearInterval(_autoChangeInterval),void(_autoChangeInterval=setInterval(function(){ultimirror.fn.update(["layout","mirror"],"bigclock"===ultimirror.layout.mirror?"default":"bigclock")},1e4)))},changeCurrentlyDisplaying:function(e,r){var o="mirror";r&&(o="admin"),ultimirror.fn.update(["layout",o],e)}},module:{load:function(e){return new Promise(function(r,o){try{var t=require(ultimirror.path(["modules",e.moduleType,e.moduleType+".js"]));r(new t(e))}catch(i){console.error(i),o()}})},updateData:function(e,r){var o=e.moduleType+"_"+e.moduleId;for(var t in r)ultimirror.moduleInstances[o].data[t]=r[t];setTimeout(function(){ipc.emit("updateModule",{moduleType:e.moduleType,moduleId:e.moduleId,data:r})},0)},moduleReady:function(e,r){ultimirror.moduleInstances[r].load().then(function(){e.emit("moduleInitialised",{moduleType:module.moduleType,moduleId:module.moduleId})})}}};module.exports=fn;