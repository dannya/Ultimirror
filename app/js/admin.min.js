const ipc=io(window.location.origin);var Ultimirror=angular.module("Ultimirror",["ngSanitize","ngAnimate","angularMoment","oc.lazyLoad"]);angular.module("Ultimirror").directive("onFinishRender",["$timeout",function(o){return{restrict:"A",link:function(i,t,n){i.$last===!0&&o(function(){i.$emit(n.onFinishRender)})}}}]).directive("layout",["$http","$templateCache","$compile","$animate","$timeout",function(o,i,t,n,e){return{restrict:"E",link:function(r,a,l){r.$watch("ultimirror.layout",function(u){if(u){var c;c=l.admin?u.admin:r.ultimirror.config.layout?r.ultimirror.config.layout:u.mirror,c!==r.currentLayout&&(r.currentLayout=c,o.get("layouts/"+(c+".html"),{cache:i}).success(function(o){var i=a.children();0===i.length?(a.attr("data-layout",c),e(function(){n.enter(t(o)(r),a)})):n.leave(i).then(function(){a.attr("data-layout",c),e(function(){n.enter(t(o)(r),a)})})}))}},!0)},scope:!0}}]).directive("module",function(){return{restrict:"E",templateUrl:function(o,i){return"modules/"+i.type+"/"+(i.type+".html")},scope:!0,compile:function(){return function(o,i,t){var n={moduleType:t.type};n.moduleId=t.id?t.id:"default",o.moduleType=n.moduleType,o.moduleId=n.moduleId,o.moduleKey=n.moduleType+"_"+n.moduleId,ipc.emit("initialiseModuleInstance",n)}}}}),angular.module("Ultimirror").controller("UltimirrorCtrl",["$rootScope","$scope","$timeout","$parse",function(o,i,t,n){for(var e="browser",r=window.location.search.substring(1).split("&"),a=0;a<r.length;a++){var l=r[a].split("=");if("context"===decodeURIComponent(l[0])){e=decodeURIComponent(l[1]);break}}var u=document.children[0].classList.contains("admin");if(o.objectKeys=Object.keys,o.isBoolean=function(o){return o===!0||o===!1},o.changeCurrentlyDisplaying=function(o,i){ipc.emit("action",{fn:["fn","layout","changeCurrentlyDisplaying"],params:[o,i]})},ipc.emit("initialise",e),ipc.on("setData",function(o){n(o.keyPath.join(".")).assign(i,o.data),i.$apply()}),ipc.on("updateModule",function(o){t(function(){if(void 0===o)return void console.log("base no payload");var t=o.moduleType+"_"+o.moduleId;if(!i.ultimirror||!i.ultimirror.moduleInstances)return void console.log("base no instances");if(!i.ultimirror.moduleInstances[t])return void console.log("base no "+t);if(void 0!==o.data)for(var n in o.data)i.ultimirror.moduleInstances[t].data[n]=o.data[n];if(void 0!==o.config){i.ultimirror.moduleInstances[t].config||(i.ultimirror.moduleInstances[t].config={});for(var e in o.config)i.ultimirror.moduleInstances[t].config[e]=o.config[e]}if(void 0!==o.attr)for(var r in o.attr)i.ultimirror.moduleInstances[t][r]=o.attr[r];i.$apply()})}),u){var c={};ipc.on("moduleInitialised",function(o){var t=o.moduleType+"_"+o.moduleId;i.$watch("ultimirror.moduleInstances."+t+"._config",function(o,i){if(o&&i&&!angular.equals(o,i)){var t=o.moduleType+"_"+o.moduleId;void 0!==c[t]&&window.clearTimeout(c[t]),c[t]=window.setTimeout(function(){ipc.emit("action",{moduleType:o.moduleType,moduleId:o.moduleId,fn:"modifyConfig",params:[o,!0]})},250)}},!0)})}}]);