(function(n){"use strict";var e=this,t=e.SpeechRecognition||e.webkitSpeechRecognition||e.mozSpeechRecognition||e.msSpeechRecognition||e.oSpeechRecognition;if(!t)return e.annyang=null,n;var o,r,a=[],c={start:[],error:[],end:[],result:[],resultMatch:[],resultNoMatch:[],errorNetwork:[],errorPermissionBlocked:[],errorPermissionDenied:[]},i=0,s=!1,l="font-weight: bold; color: #00f;",u=!1,g=!1,f=/\s*\((.*?)\)\s*/g,h=/(\(\?:[^)]+\))\?/g,p=/(\(\?)?:\w+/g,m=/\*\w+/g,d=/[\-{}\[\]+?.,\\\^$|#]/g,y=function(n){return n=n.replace(d,"\\$&").replace(f,"(?:$1)?").replace(p,function(n,e){return e?n:"([^\\s]+)"}).replace(m,"(.*?)").replace(h,"\\s*$1?\\s*"),new RegExp("^"+n+"$","i")},v=function(n){var e=Array.prototype.slice.call(arguments,1);n.forEach(function(n){n.callback.apply(n.context,e)})},w=function(){b()||e.annyang.init({},!1)},b=function(){return o!==n},k=function(n,t,o){a.push({command:n,callback:t,originalPhrase:o}),s&&e.console.log("Command successfully loaded: %c"+o,l)};e.annyang={init:function(f,h){h=h===n?!0:!!h,o&&o.abort&&o.abort(),o=new t,o.maxAlternatives=5,o.continuous="http:"===e.location.protocol,o.lang="en-US",o.onstart=function(){g=!0,v(c.start)},o.onerror=function(n){switch(v(c.error),n.error){case"network":v(c.errorNetwork);break;case"not-allowed":case"service-not-allowed":r=!1,v((new Date).getTime()-i<200?c.errorPermissionBlocked:c.errorPermissionDenied)}},o.onend=function(){if(g=!1,v(c.end),r){var n=(new Date).getTime()-i;1e3>n?setTimeout(e.annyang.start,1e3-n):e.annyang.start()}},o.onresult=function(n){if(u)return s&&e.console.log("Speech heard, but annyang is paused"),!1;for(var t=n.results[n.resultIndex],o=[],r=0;r<t.length;r++)o[r]=t[r].transcript;v(c.result,o);for(var i,g=0;g<o.length;g++){i=o[g].trim(),s&&e.console.log("Speech recognized: %c"+i,l);for(var f=0,h=a.length;h>f;f++){var p=a[f].command.exec(i);if(p){var m=p.slice(1);return s&&(e.console.log("command matched: %c"+a[f].originalPhrase,l),m.length&&e.console.log("with parameters",m)),a[f].callback.apply(this,m),v(c.resultMatch,i,a[f].originalPhrase,o),!0}}}return v(c.resultNoMatch,o),!1},h&&(a=[]),f.length&&this.addCommands(f)},start:function(t){u=!1,w(),t=t||{},r=t.autoRestart!==n?!!t.autoRestart:!0,t.continuous!==n&&(o.continuous=!!t.continuous),i=(new Date).getTime();try{o.start()}catch(a){s&&e.console.log(a.message)}},abort:function(){r=!1,b&&o.abort()},pause:function(){u=!0},resume:function(){e.annyang.start()},debug:function(n){s=arguments.length>0?!!n:!0},setLanguage:function(n){w(),o.lang=n},addCommands:function(n){var t;w();for(var o in n)if(n.hasOwnProperty(o))if(t=e[n[o]]||n[o],"function"==typeof t)k(y(o),t,o);else{if(!("object"==typeof t&&t.regexp instanceof RegExp)){s&&e.console.log("Can not register command: %c"+o,l);continue}k(new RegExp(t.regexp.source,"i"),t.callback,o)}},removeCommands:function(e){return e===n?void(a=[]):(e=Array.isArray(e)?e:[e],void(a=a.filter(function(n){for(var t=0;t<e.length;t++)if(e[t]===n.originalPhrase)return!1;return!0})))},addCallback:function(t,o,r){if(c[t]!==n){var a=e[o]||o;"function"==typeof a&&c[t].push({callback:a,context:r||this})}},isListening:function(){return g&&!u}},exports.annyang=e}).call(this);