const execSync=require("child_process").execSync,moment=require("moment"),os=require("os"),Promise=require("promise"),UltimirrorModule=require(ultimirror.path(["js","ultimirror","module.js"])),System=UltimirrorModule.extend("System",{moduleType:"system",moduleName:"System",update:!1,defaultConfig:[{id:"firstName",name:"First name",initial:""},{id:"lastName",name:"Last name",initial:""},{id:"timeFormat",name:"Time format",initial:"12hour",values:{"12hour":"12 hour","24hour":"24 hour"}},{id:"timeZone",name:"Time zone",initial:"gmt",values:{gmt:"GMT"}},{id:"temperatureUnits",name:"Temperature units",initial:"metric",values:{metric:"Metric",imperial:"Imperial"}},{id:"showIntro",name:"Show intro screen on start (seconds)",initial:12}],getData:function(){var e=this,i=os.platform();return new Promise(function(r){var t;if("win32"===i){var o=execSync("wmic os get lastbootuptime").toString("utf8").split("\n")[1].trim(),n=moment(o.substring(0,8)+" "+o.substring(8,14));t=n.fromNow(!0)}else t=execSync("uptime").toString("utf8").split(",")[0].split(" up ")[1];var m=os.networkInterfaces(),s={};Object.keys(m).forEach(function(e){var i=0;m[e].forEach(function(r){"IPv4"===r.family&&r.internal===!1&&(i>=1?s[e+":"+i]=r.address:s[e]=r.address,++i)})});var a;for(var u in s)if(s[u].startsWith("192")){a=s[u];break}a||(a=s[Object.keys(s)[0]]);var l=a+(80!==ultimirror.config.port?":"+ultimirror.config.port:"");e.dataLoaded||console.info("Configure this mirror @ http://"+l+"\nView this mirror @ http://"+l+"/mirror\n"),r({uptime:t,addresses:s,ip:a,ip_display:l})})}});module.exports=System;